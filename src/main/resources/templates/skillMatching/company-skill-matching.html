<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/static/css/company-skill-matching.css}"/>
    <title>기업 기술매칭</title>
</head>
<body>
<div th:replace="~{layout/fragments/header :: header}"></div>
<main>
    <select onchange="changeSkill(this)" name="skillSelect" class="select_box" id="skillSelectBox">
        <option value="none" selected style="background-color: white; color:black;">기술스택<i
                class="bi bi-chevron-down"></i></option>
        <th:block th:each="skill : ${skillGubnList}">
            <option th:value="${skill.code}" style="background-color: white; color:black;">[[${skill.name}]]</option>
        </th:block>
    </select>
    <div id="offerContainer">
        <div th:each="offerYuser, state : ${offerYList}">
            <div class="offerY-item">
                [[${offerYuser.userName}]] <span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span>[[${offerYuser.title}]]<br/>
                [[${offerYuser.userGender}]] <span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                [[${offerYuser.userAge}]]<span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                <span th:if="${offerYuser.jobHistory > 0}"> 경력 [[${offerYuser.jobHistory}]]년 이상</span>
                <span th:if="${offerYuser.jobHistory == 0}"> 신입</span>
                <span class="skill_codes">기술스택</span>
                <th:block th:each="skill : ${offerYuser.skillList}">
                    <span class="skill_box">[[${skill.name}]]</span>
                </th:block>

                <span class="right">
                    <i onclick="likeUser(this)" th:data-user-id="${offerYuser.userId}" th:class="${offerYuser.likeYn == 'Y' ? 'bi bi-suit-heart-fill like-btn' : 'bi bi-suit-heart like-btn'} " ></i>
                </span>
            </div>
        </div>
    </div>

</main>
<div th:replace="~{layout/fragments/footer :: footer}"></div>
<script>
    const skillSelect = document.getElementById("skillSelectBox");

    // skillSelect.addEventListener("change", function () {
    //     const selectedValue = this.value;
    //     console.log(selectedValue);
    //     axios.get('/api/companySkillMatching/select', {
    //         params: {
    //             skillCode: selectedValue
    //         }
    //     })
    //         .then(function (response) {
    //             console.log(response);
    //             const offerSkillMatchingList = response.data;
    //             renderSkillMatchingList(offerSkillMatchingList);
    //         })
    //         .catch(function (error) {
    //             console.log(error);
    //         });
    // });

    function changeSkill(ele){
        const selectedValue = ele.value;
        console.log(selectedValue);
        axios.get('/api/companySkillMatching/select', {
            params: {
                skillCode: !ele ? '': selectedValue
            }
        })
            .then(function (response) {
                console.log(response);
                const offerSkillMatchingList = response.data;
                renderSkillMatchingList(offerSkillMatchingList);
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    changeSkill();

    function renderSkillMatchingList(offerSkillMatchingList) {
        const offerContainer = document.getElementById('offerContainer');
        offerContainer.innerHTML = '';
        offerSkillMatchingList.forEach(skillMatchingUser => {
            const skillMatchingItem = document.createElement('div');
            skillMatchingItem.classList.add('offerY-item');

            let skillHtml = '';
            // 기술 스택 목록 생성
            skillMatchingUser.skillList.forEach(skill => {
                skillHtml += `<span class="skill_box">${skill.name}</span>`;
            });

            skillMatchingItem.innerHTML = `

                    ${skillMatchingUser.userName} <span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span> ${skillMatchingUser.title} <br/>
                    ${skillMatchingUser.userGender} <span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span> ${skillMatchingUser.userAge} <span class="side_line">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                    ${skillMatchingUser.jobHistory > 0 ? `경력 ${skillMatchingUser.jobHistory}년 이상` : '신입'}<br/>
                    <span class="skill_codes">기술스택:</span> ${skillHtml}


                    <span class="right"><i onclick="likeUser(this)" data-user-id="${skillMatchingUser.userId}" class="${skillMatchingUser.likeYn ? 'bi bi-suit-heart-fill like-btn' : 'bi bi-suit-heart like-btn'} " ></i></span>
            `;

            offerContainer.appendChild(skillMatchingItem);  // 컨테이너에 추가
        });
    }


    function likeUser(ele) {
        const likeArr = ['bi-suit-heart-fill', 'bi-suit-heart'];
        const userId = ele.getAttribute('data-user-id');  // Get the user ID from the element

        // Send a POST request to like/unlike the user
        axios.post("/api/like/" + userId)
            .then(res => {
                console.log(res);
                if (res.data == 1) {

                    if (ele.classList.contains('bi-suit-heart')) {
                        ele.classList.remove('bi-suit-heart');
                        ele.classList.add('bi-suit-heart-fill');
                    }

                    else if (ele.classList.contains('bi-suit-heart-fill')) {
                        ele.classList.remove('bi-suit-heart-fill');
                        ele.classList.add('bi-suit-heart');
                    }
                }
            })
            .catch(error => {
                console.log(error);
            });

    }


</script>
</body>
</html>